<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <link href="../Css/frame.css" rel="stylesheet" type="text/css" />
  <link href="../Css/jquery-ui-latest.custom.css" rel="stylesheet" type="text/css" />
  <link href="../Css/jquery-ui-enhanced.css" rel="stylesheet" type="text/css" />
  <link href="../Css/ts.ui.css" rel="stylesheet" type="text/css" />
  <!--[if IE 7]><link href="vcr/1_7_9/Css/ts.ui.ie7.css" rel="stylesheet" type="text/css" /><![endif]--><!--[if IE 8]><link href="vcr/1_7_9/Css/ts.ui.ie8.css" rel="stylesheet" type="text/css" /><![endif]-->

  <script src="../Js/jquery-latest.min.js" type="text/javascript"></script>
  <script src="../Js/jquery-ui-latest.custom.min.js" type="text/javascript"></script>

  <style type="text/css">
    .ts-toolbar { border-top: none; }
    #divCopyConfirm { padding: 1em 1em; margin: 1em 0;}
  </style>

  <script language="javascript" type="text/javascript">

    $(document).ready(function () {
      $('button').button();
      $('#btnRefresh').click(function (e) { e.preventDefault(); window.location = window.location; });
      $('.ts-loading').hide().next().show();

      function addToolbarButton(id, icon, caption, callback) {
        var html = '<a href="#" id="' + id + '" class="ts-toolbar-button ui-corner-all"><span class="ts-toolbar-icon ts-icon ' + icon + '"></span><span class="ts-toolbar-caption">' + caption + '</span></a>';
        $('.ts-toolbar').append(html).find('#' + id).click(callback).hover(function () { $(this).addClass('ui-state-hover'); }, function () { $(this).removeClass('ui-state-hover'); });
      }

      addToolbarButton('btnRefresh', 'ts-icon-refresh', 'Refresh', function (e) {
        e.preventDefault();
        e.stopPropagation();
        window.location = window.location;
      });


      var execGetOrganization = null;
      function getOrganizations(request, response) {
        if (execGetOrganization) { execGetOrganization._executor.abort(); }
        execGetOrganization = top.Ts.Services.Organizations.AdminGetOrganizations(request.term, function (result) { response(result); });
      }

      $('#textOrgID').autocomplete({
        minLength: 2,
        source: getOrganizations,
        select: function (event, ui) {
          $(this).data('itemID', ui.item.id);
          top.Ts.Services.Organizations.GetOrganization(ui.item.id, function (org) {
          });
        }
      });

      $('#btnSearch').click(function (e) {
        e.preventDefault();
        $('#divResults').empty();
        top.Ts.Services.Tickets.SearchTicketsTest($('#textSearch').val(), $('#textOrgID').data('itemID'), function (results) {
          $('<div>').html(results.length + ' tickets found.').appendTo('#divResults');
          for (var i = 0; i < results.length; i++) {
            $('<div>').html(results[i]).appendTo('#divResults');
          }
          $('#divResults h1').click(function (e) {
            $(this).toggle();
          });
          
        });

      });
    });  
  </script>

</head>
<body>
  <div class="ts-loading">
  </div>
  <div class="frame-content ts-content ui-widget">
    <div class="ts-toolbar ui-widget-header">
    </div>
    <div class="frame-content-wrapper">

      <div class="ts-section ui-widget-content  ui-corner-all">
        <h2>Organization</h2>
        <input class="text ui-corner-all ui-widget-content" type="text" id="textOrgID" style="width: 250px;" />
        <h2>Search</h2>
        <input class="text ui-corner-all ui-widget-content" type="text" id="textSearch" style="width: 250px;" />
        <button id="btnSearch">Search</button>

        <div id="divResults">
        </div>
        
      </div>
      
    </div>
  </div>
</body>
</html>
