!function(e,n){"use strict";function t(e,n){for(var t,r=[],o=0;o<e.length;++o){if(t=c[e[o]]||a(e[o]),!t)throw"module definition dependecy not found: "+e[o];r.push(t)}n.apply(null,r)}function r(e,r,o){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(r===n)throw"invalid module definition, dependencies must be specified";if(o===n)throw"invalid module definition, definition function must be specified";t(r,function(){c[e]=o.apply(null,arguments)})}function o(e){return!!c[e]}function a(n){for(var t=e,r=n.split(/[.\/]/),o=0;o<r.length;++o){if(!t[r[o]])return;t=t[r[o]]}return t}function i(t){var r,o,a,i,l;for(r=0;r<t.length;r++){o=e,a=t[r],i=a.split(/[.\/]/);for(var s=0;s<i.length-1;++s)o[i[s]]===n&&(o[i[s]]={}),o=o[i[s]];o[i[i.length-1]]=c[a]}if(e.AMDLC_TESTS){l=e.privateModules||{};for(a in c)l[a]=c[a];for(r=0;r<t.length;r++)delete l[t[r]];e.privateModules=l}}var c={},l="tinymce/tinymcespellcheckerplugin/DomTextMatcher",s="tinymce/tinymcespellcheckerplugin/SpellingCache",u="tinymce/util/JSON",d="tinymce/tinymcespellcheckerplugin/Plugin",f="tinymce/PluginManager",h="tinymce/util/Tools",g="tinymce/ui/Menu",p="tinymce/dom/DOMUtils",m="tinymce/util/XHR",v="tinymce/util/URI";r(l,[],function(){return function(e,n,t){function r(e,n){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";return{start:e.index,end:e.index+e[0].length,text:e[0],data:n}}function o(e){var n;if(3===e.nodeType)return e.data;if(v[e.nodeName]&&!m[e.nodeName])return"";if(n="",(m[e.nodeName]||k[e.nodeName])&&(n+="\n"),e=e.firstChild)do n+=o(e);while(e=e.nextSibling);return n}function a(e){function n(e,n){for(var t=0;t<e.length;t++)if(e[t]===n)return!0;return!1}for(var t=[],r=0;r<e.length;r++)n(t,e[r])||t.push(e[r]);return t}function i(e){var n=o(e).match(t);return n?a(n):[]}function c(e,n,t){var r,o,a,i,c=[],l=0,s=e,u,d=0;n=n.slice(0),n.sort(function(e,n){return e.start-n.start}),u=n.shift();e:for(;;){if((m[s.nodeName]||k[s.nodeName])&&l++,3===s.nodeType&&(!o&&s.length+l>=u.end?(o=s,i=u.end-l):r&&c.push(s),!r&&s.length+l>u.start&&(r=s,a=u.start-l),l+=s.length),r&&o){for(var f=!1,h=r;h!=e;h=h.parentNode)h.className===x&&(f=!0);if(f||(s=t({startNode:r,startNodeIndex:a,endNode:o,endNodeIndex:i,innerNodes:c,match:u.text,matchIndex:d}),l-=o.length-i),r=null,o=null,c=[],u=n.shift(),d++,!u)break}else{if((!v[s.nodeName]||m[s.nodeName])&&s.firstChild){s=s.firstChild;continue}if(s.nextSibling){s=s.nextSibling;continue}}for(;;){if(s.nextSibling){s=s.nextSibling;break}if(s.parentNode===e)break e;s=s.parentNode}}}function l(e,n){function t(t,r){var o=e[r];o.stencil||(o.stencil=n(o));var a=o.stencil.cloneNode(!1);return a.setAttribute("data-mce-index",r),t&&a.appendChild(p.doc.createTextNode(t)),a}return function(e){var n,r,o,a=e.startNode,i=e.endNode,c=e.matchIndex,l=p.doc;if(a===i){var s=a;o=s.parentNode,e.startNodeIndex>0&&(n=l.createTextNode(s.data.substring(0,e.startNodeIndex)),o.insertBefore(n,s));var u=t(e.match,c);return o.insertBefore(u,s),e.endNodeIndex<s.length&&(r=l.createTextNode(s.data.substring(e.endNodeIndex)),o.insertBefore(r,s)),s.parentNode.removeChild(s),u}n=l.createTextNode(a.data.substring(0,e.startNodeIndex)),r=l.createTextNode(i.data.substring(e.endNodeIndex));for(var d=t(a.data.substring(e.startNodeIndex),c),f=[],h=0,g=e.innerNodes.length;g>h;++h){var m=e.innerNodes[h],v=t(m.data,c);m.parentNode.replaceChild(v,m),f.push(v)}var k=t(i.data.substring(0,e.endNodeIndex),c);return o=a.parentNode,o.insertBefore(n,a),o.insertBefore(d,a),o.removeChild(a),o=i.parentNode,o.insertBefore(k,i),o.insertBefore(r,i),o.removeChild(i),k}}function s(e,n){for(var t=e.length;t--;)if(e[t]===n)return t;return-1}function u(e,n){var t=[];return d(e,function(e,r){n(e,r)&&t.push(e)}),e=t,t}function d(e,n){for(var t=0,r=e.length;r>t&&n(e[t],t)!==!1;t++);return this}function f(e,n,t){return e.length&&c(t,e,l(e,n)),this}function h(e,n,t){var a=[],i=o(t);if(i&&e.global)for(;g=e.exec(i);)a.push(r(g,n));return a}var g,p=n.dom,m,v,k,x="mce-spellchecker-ignore";return m=n.schema.getBlockElements(),v=n.schema.getWhiteSpaceElements(),k=n.schema.getShortEndedElements(),{getText:o,getWords:i,each:d,filter:u,find:h,wrap:f,indexOf:s}}}),r(s,[u],function(e){return function(){function n(e){return e.replace(/\uFEFF/g,"")}function t(t,o,i,s){var u=a(t),d=n(o),f={misspelled:i,suggestions:s};u[t][d]=f,r()?sessionStorage.setItem(c,e.serialize(u)):l=u}function r(){return"undefined"!=typeof Storage}function o(e,n){return n[e]||(n[e]={}),n}function a(n){var t=r()&&sessionStorage.getItem(c)?e.parse(sessionStorage.getItem(c)):l;return o(n,t)}function i(e,t){var r=a(e),o=n(t),i=r[e][o]?r[e][o]:!1;return i&&i.suggestions&&i.suggestions.length>s&&(i.suggestions=i.suggestions.slice(0,s)),i}var c="tinyMCESpellingCache",l={},s=5;return{addWordToCache:t,retrieveWordFromCache:i}}}),r(d,[l,s,f,h,g,p,m,v,u],function(e,t,r,o,a,i,c,l,s){r.add("tinymcespellchecker",function(r,u){function d(){return q.textMatcher||(q.textMatcher=new e(r.getBody(),r,g())),q.textMatcher}function f(){return q.spellingCache||(q.spellingCache=new t),q.spellingCache}function h(e,n){var t=[],c=f().retrieveWordFromCache(J.spellchecker_language,e).suggestions;o.each(c,function(e){t.push({text:e,onclick:function(){r.insertContent(r.dom.encode(e)),r.dom.remove(n)}})}),t.push({text:"-"}),t.push.apply(t,[{text:"Ignore",onclick:function(){N(e,n)}},{text:"Ignore all",onclick:function(){N(e,n,!0)}}]),H=new a({items:t,context:"contextmenu",onautohide:function(e){-1!=e.target.className.indexOf("spellchecker")&&e.preventDefault()},onhide:function(){H.remove(),H=null}}),H.renderTo(document.body);var l=i.DOM.getPos(r.getContentAreaContainer()),s=r.dom.getPos(n[0]),u=r.dom.getRoot();"BODY"==u.nodeName?(s.x-=u.ownerDocument.documentElement.scrollLeft||u.scrollLeft,s.y-=u.ownerDocument.documentElement.scrollTop||u.scrollTop):(s.x-=u.scrollLeft,s.y-=u.scrollTop),l.x+=s.x,l.y+=s.y,H.moveTo(l.x,l.y+n[0].offsetHeight)}function g(){return r.getParam("spellchecker_wordchar_pattern")||new RegExp(G,"g")}function p(e){return e.replace(/\uFEFF/g,"")}function m(e){for(var n={},t=[],r=[],o=0;o<e.length;o++){var a=f().retrieveWordFromCache(J.spellchecker_language,e[o]);a&&a.misspelled&&(n[e[o]]=a),a||(t.push({original:e[o],cleaned:p(e[o])}),r.push(p(e[o])))}return{cachedData:n,wordsToCheck:t,cleanedWordsForServer:r}}function v(e,n,t){function o(e){r.windowManager.alert(e)}var a="/"+j+"/correction",i={url:new l(u).toAbsolute(J.spellchecker_rpc_url+a),type:"post",content_type:"application/json",data:s.serialize(e),success:function(e){e=s.parse(e),e?e.error?o(e.error):_(n.cachedData,e,n.wordsToCheck,t):o("Server response wasn't proper JSON.")},error:function(e,n){o("Spellchecker request error: "+n.status)}};return J.spellchecker_api_key&&(i.requestheaders=[{key:"tiny-api-key",value:J.spellchecker_api_key}]),i}function k(e,n){var t=m(e),r={words:t.cleanedWordsForServer,language:J.spellchecker_language};if(t.wordsToCheck.length>0){var o=v(r,t,n);c.send(o)}else _(t.cachedData,{},t.wordsToCheck,n)}function x(e){k(d().getWords(e),e),r.focus()}function N(e,n,t){r.selection.collapse(),t?o.each(r.dom.select("span."+Y),function(n){n.getAttribute("data-mce-word")==e&&(n.className=Q)}):o.each(n,function(e){e.className=Q})}function y(e){var n=e.getAttribute("data-mce-index");return"number"==typeof n?""+n:n}function w(e,n){var t,r=[];if(t=o.toArray(n.getElementsByTagName("span")),t.length)for(var a=0;a<t.length;a++){var i=y(t[a]);null!==i&&i.length&&i===e.toString()&&r.push(t[a])}return r}function C(e){var n=J.spellchecker_language;o.each(e.control.items(),function(e){e.active(e.data.data===n)})}function b(e){e.control.on("show",function(e){C(e)})}function S(e){ee=e.control,e.control.on("show",function(){this.active(Z)}),ee.active(Z)}function T(e,n,t){var r={};for(var o in e)e[o]&&e[o].misspelled&&(r[o]=e[o].suggestions);for(var a in n.spell){f().addWordToCache(J.spellchecker_language,a,!0,n.spell[a]);for(var i=0;i<t.length;i++)if(t[i].cleaned===a){r[t[i].original]=n.spell[a];break}}return r}function B(e){for(var n=0;n<e.length;n++){var t=f().retrieveWordFromCache(J.spellchecker_language,e[n].cleaned);t||f().addWordToCache(J.spellchecker_language,e[n].cleaned,!1,[])}}function _(e,n,t,r){var o=T(e,n,t);B(t),F(o,r)}function I(e){for(var n=e.parentNode,t=e.childNodes;t.length>0;)n.insertBefore(t[0],e);e.parentNode.removeChild(e)}function M(e){for(var n=r.dom.select("span."+Y,e),t=0;t<n.length;t++)I(n[t])}function F(e,t){var o=r.selection.getBookmark();M(t);var a=d().find(g(),n,t);a=d().filter(a,function(n){return!!e[n.text]}),d().wrap(a,function(e){return r.dom.create("span",{"class":Y,"data-mce-bogus":1,"data-mce-word":e.text})},t),r.selection.moveToBookmark(o)}function D(e){var t=r.getBody(),o=t,a=r.schema.getBlockElements();for(e=e;e!=t&&(null!==e&&e!==n);e=e.parentNode)if(a[e.nodeName]){o=e;break}return o}function E(e,n){var t=[];return o.each(n,function(e){t.push({selectable:!0,text:e.name,data:e.value,onclick:function(){J.spellchecker_language=e.value,Z&&x(r.getBody())}})}),t}function W(){Z?(U(),M(r.getBody())):(z(),x(r.getBody())),Z=!Z,$.active(Z),ee&&ee.active(Z)}function P(){H&&(H.remove(),H=null)}function O(e){if(37!==(e.which||e.keycode)&&38!==(e.which||e.keycode)&&39!==(e.which||e.keycode)&&40!==(e.which||e.keycode)){var n=r.selection.getNode();if(i.DOM.hasClass(n,Y)||i.DOM.hasClass(n,Q)){var t=D(n),o=w(y(n),t);if(o.length>0){for(var a=r.selection.getBookmark(),c=0;c<o.length;c++)I(o[c]);r.selection.moveToBookmark(a)}}}}function A(e){var n=r.selection.getNode(),t=D(n);32===(e.which||e.keycode)&&x(t)}function R(e){if(!e.selectionChange){var n=V;V=D(e.element),n!==V&&n&&x(n)}}function L(e){var n=e.target;if(i.DOM.hasClass(n,Y)){var t=w(y(n),D(n));if(t.length>0){var o=r.dom.createRng();o.setStartBefore(t[0]),o.setEndAfter(t[t.length-1]),r.selection.setRng(o),h(n.getAttribute("data-mce-word"),t,e)}e.preventDefault(),e.stopImmediatePropagation()}}function z(){r.on("remove",P),r.on("keydown",O),r.on("keyup",A),r.on("nodechange",R)}function U(){r.off("remove",P),r.off("keydown",O),r.off("keyup",A),r.off("nodechange",R)}var q=this,H,J=r.settings,j=1,G="[\\w'\\-\\u00C0-\\u00FF\\uFEFF\\u2018\\u2019]+",K=J.spellchecker_languages||"US English=en,UK English=en_gb,Danish=da,Dutch=nl,Finnish=fi,French=fr,German=de,Italian=it,Norwegian=nb,Brazilian Portuguese=pt,Iberian Portuguese=pt_pt,Spanish=es,Swedish=sv",X,Y="mce-spellchecker-word",Q="mce-spellchecker-ignore",V,Z=!0,$,ee;X=E("Language",o.map(K.split(","),function(e){return e=e.split("="),{name:e[0],value:e[1]}}));var ne={tooltip:"Spellcheck",onclick:W,onPostRender:function(e){e.control.active(Z)}};X.length>1&&(ne.type="splitbutton",ne.menu=X,ne.onshow=C,ne.onpostrender=function(e){$=e.control}),r.addButton("spellchecker",ne),r.addCommand("mceSpellCheck",W),r.addMenuItem("spellchecker",{text:"Spellcheck",context:"tools",onclick:W,onPostRender:S,selectable:!0}),r.addMenuItem("spellcheckerlanguage",{text:"Spellcheck Language",context:"tools",menu:X,onPostRender:b}),r.on("contextmenu",L,!0),z(),this.getTextMatcher=d,this.getWordCharPattern=g,this.markErrors=F,this.getLanguage=function(){return J.spellchecker_language},J.spellchecker_language=J.spellchecker_language||J.language||"en"})}),i([l,s])}(this);