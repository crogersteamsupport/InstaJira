<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <link href="../Css/frame.css" rel="stylesheet" type="text/css" />
  <link href="../Css/jquery-ui-latest.custom.css" rel="stylesheet" type="text/css" />
  <link href="../Css/jquery-ui-enhanced.css" rel="stylesheet" type="text/css" />
  <link href="../Css/ts.ui.css" rel="stylesheet" type="text/css" />
  <!--[if IE 7]><link href="Resources_140/Css/ts.ui.ie7.css" rel="stylesheet" type="text/css" /><![endif]--><!--[if IE 8]><link href="Resources_140/Css/ts.ui.ie8.css" rel="stylesheet" type="text/css" /><![endif]-->

  <style type="text/css">
    .utils-content { border:none; padding: 2em 2em;}
    #divProperties { margin-top: 2em; line-height: 1.5em; font-size: 1.2em; }
    #divFunctions { margin-top: 2em; }
  </style>

  <script src="../Js/jquery-latest.min.js" type="text/javascript"></script>
  <script src="../Js/jquery-ui-latest.custom.min.js" type="text/javascript"></script>

  <script language="javascript" type="text/javascript">

    $(document).ready(function () {
      var _ticket = null;

      $('button').button();
      $('.ts-loading').hide().next().show();

      $('#btnGetTicketByID').click(function (e) {
        e.preventDefault();
        top.Ts.Services.Tickets.AdminGetTicketByID($('#textTicketID').val(), loadTicket);
      });

      $('#btnGetTicketByNumber').click(function (e) {
        e.preventDefault();
        top.Ts.Services.Tickets.AdminGetTicketByNumber($('#textOrgID').data('itemID'), $('#textTicketNumber').val(), loadTicket);
      });

      $('#linkCleanEmail').click(function (e) {
        e.preventDefault();
        top.Ts.Services.Tickets.AdminCleanAllEmailActions(_ticket.TicketID, function () { alert('Email actions cleaned.'); });

      });

      $('#linkCleanAll').click(function (e) {
        e.preventDefault();
        top.Ts.Services.Tickets.AdminCleanAllActions(_ticket.TicketID, function () { alert('All actions cleaned.'); });
      });

      var execGetOrganization = null;
      function getOrganizations(request, response) {
        if (execGetOrganization) { execGetOrganization._executor.abort(); }
        execGetOrganization = top.Ts.Services.Organizations.AdminGetOrganizations(request.term, function (result) { response(result); });
      }

      $('#textOrgID').autocomplete({
        minLength: 2,
        source: getOrganizations,
        select: function (event, ui) {
          $(this).data('itemID', ui.item.id);
        }

      });


      function loadTicket(ticket) {
        _ticket = ticket;
        if (!ticket) {
          $('#divTicket').hide();
          alert('Unable to find the ticket.');
          return;

        }

        $('#divTicket').show();
        var properites = $('#divProperties').empty();
        $('<div>').text('Ticket ID: ' + ticket.TicketID ).appendTo(properites);
        $('<div>').text('Organization ID: ' + ticket.OrganizationID).appendTo(properites);
        $('<div>').text('Number: ' + ticket.TicketNumber).appendTo(properites);
        $('<div>').text('Title: ' + ticket.Name).appendTo(properites);

        top.Ts.Services.Tickets.AdminGetActions(ticket.TicketID, function (actions) {
          var html = '<table>'
          for (var i = 0; i < actions.length; i++) {
            html = html + '<tr>'
            html = html + '<td><a href="#" onclick="top.Ts.Services.Tickets.AdminCleanAction(' + actions[i].ActionID + ', function(){ alert(\'Action cleaned.\');}); return false;">Clean</a></td>';
            html = html + '<td>' + actions[i].ActionID + '</td>';
            html = html + '<td>' + actions[i].ActionType + '</td>';
            html = html + '<td>' + actions[i].Name + '</td>';
            html = html + '</tr>'
          }
          $('#divActions').html(html);
        });
      }


    });  
  </script>


</head>
<body>
  <div class="ts-loading"></div>

  <div class="utils-content ui-widget ui-widget-content">
    <div>
    Ticket ID: <input class="text  ui-corner-all ui-widget-content" type="text" id="textTicketID" /> <button id="btnGetTicketByID">Get Ticket</button>
    </div>
    <h3> -- OR -- </h3>
    <div>
    Organization: <input class="text ui-corner-all ui-widget-content" type="text" id="textOrgID" style="width: 250px;" />  Ticket #: <input class="text ui-corner-all ui-widget-content" type="text" id="textTicketNumber" /> <button id="btnGetTicketByNumber">Get Ticket</button>
    </div>
    <div id="divTicket" class="ui-helper-hidden">
      <div id="divFunctions">
        <button id="linkCleanEmail">Clean All Email Actions</button>
        <button id="linkCleanAll">Clean All Actions</button>
      </div>
      <div id="divProperties"></div>
      <h2>Actions</h2>
      <div id="divActions"></div>
    </div>
  </div>
</body>
</html>
